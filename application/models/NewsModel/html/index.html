<script>var eventBinder = new NewsEventBinder();</script>

<!--
<?php if ( !empty($data->_recentRaids) ): ?>
    <div class="container-fluid">
        <div class="row" style="margin-top:5px; margin-bottom:5px;">
            <div class="col-lg-12 col-md-12 hidden-xs hidden-sm">
                <div id="carouselLatestKills" class="carousel slide" data-interval="false" data-ride="carousel" style="width:1366px; height:80px; margin:0 auto;">
                    <div class="carousel-inner" role="listbox" style="height:80px; margin:0 auto; padding-left:25px; padding-right:25px;">
                        <?php $numOfKills  = count($data->_recentRaids); ?>
                        <?php $numOfSlides = floor($numOfKills / 10); ?>
                        <?php $slideArray  = array(); ?>
                        <?php $slideCount  = 0; ?>
                        <?php $killCount   = 0; ?>
                        <?php $html        = ''; ?>

                        <?php foreach( $data->_recentRaids as $key => $timestamp ): ?>
                            <?php
                                $html .= '<div class="text-cut" style="float:left; width:130px; padding-left: 5px; padding-right: 5px; border-right: 1px solid #000;">
                                    <a href="' . Functions::generateInternalHyperLink('guild', '', $data->_recentRaids[$key]->server, $data->_recentRaids[$key]->name, 0, false) . '"></a>
                                    <div class="latest-guild">' . $data->_recentRaids[$key]->guild . '</div>
                                    <div class="latest-kill">' . $data->_recentRaids[$key]->encounter . '</div>
                                    <div class="latest-time">' . $data->_recentRaids[$key]->time . '</div>
                                    <div class="latest-media">
                                        SS: ' . $data->_recentRaids[$key]->screenshot . '
                                          |  
                                        Vid: ' . $data->_recentRaids[$key]->video . '
                                    </div>
                                </div>';
                            ?>

                            <?php $killCount++; ?>

                            <?php if ( $killCount % $numOfSlides == 0 ): ?>
                                <?php $slideArray[] = $html; ?>
                                <?php $html = ''; ?>
                            <?php endif; ?>
                        <?php endforeach; ?>

                        <?php $slideCount = 0; ?>
                        <?php foreach( $slideArray as $slide ): ?>
                            <?php $activeClass = ''; ?>

                            <?php if ( $slideCount == 0 ): ?>
                                <?php $activeClass = ' active'; ?>
                            <?php endif; ?>

                            <div class="item<?php echo $activeClass; ?>">
                                <?php echo $slide; ?>
                            </div>

                            <?php $slideCount++; ?>
                        <?php endforeach; ?>
                    </div>

                    <a class="left carousel-control" href="#carouselLatestKills" role="button" data-slide="prev" style="width:20px;">
                        <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="right carousel-control" href="#carouselLatestKills" role="button" data-slide="next" style="width:20px;">
                        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
<?php endif; ?>
-->
<?php echo Advertisement::getLeaderboardAd(); ?>

<div class="container-fluid">
    <div class="row">
        <div id="main-content" class="col-lg-9 col-md-12 col-sm-12 col-xs-12">
            <?php if ( !empty($data->_videoLinks) ): ?>
                <div id="media-wrapper" class="row">
                    <div class="col-lg-12 col-md-12">
                        <div id="carouselStreams" class="carousel slide" data-ride="carousel">
                            <!-- Indicators -->
                            <ol class="carousel-indicators">
                                <?php $indicatorCount = 0; foreach( $data->_videoLinks as $twitchId => $twitchDetails ): ?>
                                    <li data-target="#carouselStreams"
                                        data-slide-to="<?php echo $indicatorCount; ?>"
                                        <?php if ( $indicatorCount == 0 ): ?> 
                                            class="active"
                                        <?php endif; ?>>
                                    </li>
                                    <?php $indicatorCount++; ?>
                                <?php endforeach; ?>
                            </ol>

                            <!-- Wrapper for slides -->
                            <div class="carousel-inner" role="listbox">
                                <?php $slideCount = 0; foreach( $data->_videoLinks as $twitchId => $twitchDetails ): ?>
                                    <div class="item <?php if ( $slideCount == 0 ): ?>active <?php endif; ?>">
                                        <div class="media-overlay-top">
                                            <div class="media-overlay-top-content">
                                                <?php echo Functions::generateExternalHyperLink(TWITCH_URL, IMG_TWITCH_LOGO, 0); ?>
                                            </div>
                                        </div>

                                        <div class="media-overlay-bottom">
                                            <div class="media-overlay-bottom-content">
                                                <div class="media-guild-logo pull-right">
                                                    <?php echo $twitchDetails->_guildDetails->_logo; ?>
                                                </div>
                                                <div class="media-text-content">
                                                    <h3 style="margin:-4px 0px 0px 5px; color:#FFFFFF;">
                                                        <div><small style="color: #FFFFFF">Now Streaming via Twitch</small></div>
                                                        <div><small style="color: #FFFFFF"><?php echo $twitchDetails->_twitchId; ?></small></div>
                                                        <div><?php echo $twitchDetails->_guildDetails->_name; ?>
                                                            <small style="color: #FFFFFF">
                                                                (<?php echo $twitchDetails->_guildDetails->_region . '-' . $twitchDetails->_guildDetails->_server; ?>)
                                                            </small>
                                                        </div>
                                                    </h3>
                                                </div>
                                                <div class="media-guild-flag">
                                                    <?php echo Functions::getImageFlag($twitchDetails->_guildDetails->_country, 'large'); ?>
                                                </div>
                                            </div>
                                        </div>

                                        <a href="<?php echo $twitchDetails->_hyperlink; ?>" target="_blank">
                                            <?php echo $twitchDetails->_image; ?>
                                        </a>

                                    </div>
                                    <?php $slideCount++; ?>
                                <?php endforeach; ?>
                            </div>

                            <!-- Left and right controls -->
                            <a class="left carousel-control" href="#carouselStreams" role="button" data-slide="prev" style="width:18%;">
                                <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                                <span class="sr-only">Previous</span>
                            </a>
                            <a class="right carousel-control" href="#carouselStreams" role="button" data-slide="next" style="width:18%;e">
                                <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                                <span class="sr-only">Next</span>
                            </a>
                        </div>
                    </div>
                </div>

                <div style="margin-top:5px"></div>
            <?php endif; ?>
            <div id="standings-wrapper" class="row">
                <?php $count = 0; foreach( $data->_guildStandings as $dungeonId => $dataArray ): ?>
                    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover table-condensed table-curved">
                                <thead>
                                    <?php echo Template::drawSubTitleTableRow($dataArray->tableFields, $dataArray->headerText, 'Spreadsheet', $dataArray->dataDetails->_dungeonId); ?>
                                </thead>
                                <tbody>
                                    <?php if ( !empty($dataArray->data) ): ?>
                                        <?php echo Template::drawSubHeaderTableRow($dataArray->tableFields); ?>

                                        <?php foreach( $dataArray->data as $guildId => $guildDetails ): ?>
                                            <?php echo Template::drawBodyTableRow($dataArray->tableFields, $guildDetails); ?>
                                        <?php endforeach; ?>
                                    <?php else: ?>
                                        <?php echo Template::drawEmptyGuildTableRow($dataArray->tableFields, 'No guild data found.'); ?>
                                    <?php endif; ?>
                                </tbody>
                            </table>
                        </div>
                    </div>
                <?php endforeach; ?>
            </div>

            <div id="articles-wrapper" class="row">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <?php foreach( $data->_newsArticles as $date => $article ): ?>
                    <div class="panel panel-primary">
                        <div class="panel-heading"><span class="h4"><?php echo $article->title; ?></span></div>
                        <div class="panel-footer">Posted by: <?php echo $article->postedBy . ' @ ' . $article->date; ?></div>
                        <div class="panel-body"><?php echo $article->content; ?></div>
                    </div>
                    <?php endforeach; ?>
                </div>
            </div>
        </div>
        <div id="side-content" class="col-lg-3 col-md-12 col-sm-12 col-xs-12">
            <div class="row">
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                    <div class="panel panel-primary">
                        <div class="panel-heading"><span class="h4"><?php echo SITE_TITLE; ?> Top 10</span></div>
                        <div class="panel-body">
                            <div id="side-block-rankings-wrapper">
                                <?php if ( !empty(CommonDataContainer::$rankSystemArray) ): ?>
                                    <div class="text-center">
                                        <div class="btn-group" role="group" aria-label="">

                                            <?php $count = 0; foreach( CommonDataContainer::$rankSystemArray as $systemId => $rankSystemDetails ): ?>
                                                <button id="system-selector-<?php echo $rankSystemDetails->_abbreviation; ?>"
                                                        type="button"
                                                        class="btn btn-default clickable <?php if ( $count == 0 ): ?> highlight<?php endif; ?> noselect side-ranking-systems-buttons">
                                                        <?php echo $rankSystemDetails->_abbreviation; ?>
                                                </button>
                                                <?php $count++; ?>
                                            <?php endforeach; ?>
                                        </div>
                                    </div>

                                    <div id="dungeon-slider">
                                        <?php $count = 0; foreach( $data->_guildRankings as $dungeonId => $dungeonDetails ): ?>
                                            <div id ="dungeon-rankings-clicker-<?php echo $dungeonId; ?>" class="side-ranking-header clickable noselect"><h4><?php echo $dungeonDetails['name']; ?></h4></div>
                                            <div <?php if ( $count > 0 ): ?> style="display:none;"<?php endif; ?> id="dungeon-rankings-wrapper-<?php echo $dungeonId; ?>" class="side-tables <?php if ( $count == 0 ): ?> active-dungeon <?php endif; ?>">
                                                <?php if ( !empty($dungeonDetails['data']) ): ?>
                                                     <?php $rankCount = 1; foreach( $dungeonDetails['data'] as $guildId => $systemArray ): ?>
                                                        <div class="row" style="background-color:none; height:50px;">
                                                            <div class="col-lg-9 col-md-9 col-sm-9 col-xs-9" style="background-color:none; height:50px;">
                                                                <?php $system = 0; foreach( $systemArray as $systemId => $guildDetails ): ?>
                                                                    <div style="height:25px;" class="text-cut side-rankings-details <?php echo $systemId; ?> <?php if ( $system > 0 ): ?>hidden <?php else: ?>active-rank <?php endif; ?>">
                                                                        <?php echo $guildDetails->guild; $system++; ?>
                                                                    </div>
                                                                <?php endforeach; ?>

                                                                <?php $system = 0; foreach( $systemArray as $systemId => $guildDetails ): ?>
                                                                    <div style="height:25px;" class="side-rankings-details-small <?php echo $systemId; ?> <?php if ( $system > 0 ): ?>hidden <?php else: ?>active-rank <?php endif; ?>">
                                                                        <strong><?php echo $guildDetails->points; ?></strong> <span><?php echo $guildDetails->progress; $system++; ?></span>
                                                                    </div>
                                                                <?php endforeach; ?>
                                                                
                                                            </div>
                                                            <div class="col-lg-3 col-md-3 col-sm-3 col-xs-3" style="height:50px;">
                                                                <h2 class="text-right" style="margin-top:10px;"><?php echo $guildDetails->rank;?></h2>
                                                            </div>
                                                        </div>
                                                    <?php endforeach; ?>
                                                <?php else: ?>
                                                    Ranking data currently unavailable
                                                <?php endif; ?>
                                            </div>

                                            <?php $count++; ?>
                                        <?php endforeach; ?>
                                    </div>
                                <?php else: ?>
                                    Ranking data currently unavailable
                                <?php endif; ?>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <?php echo Advertisement::getSidebarLargeAd(); ?>
            </div>
        </div>
    </div>
</div>