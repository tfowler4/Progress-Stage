<!--<script>var eventBinder = new UserPanelEventBinder();</script>-->

<div class="container-fluid">
    <div id="container-wrapper" class="row">
        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <ul class="nav nav-tabs" role="tablist">
                <li role="presentation" <?php if ( $data->_setTab == 'account' ): ?>class="active"<?php endif; ?> ><a href="#account-management" aria-controls="home" role="tab" data-toggle="tab">Account Management</a></li>
                <?php foreach ( $data->_userGuilds as $guildId => $guildDetails ): ?>
                    <li role="presentation" class="dropdown <?php if ( $data->_setTab == 'guild' ): ?>active<?php endif; ?>">
                        <a href="#" aria-controls="profile" class="dropdown-toggle" data-toggle="dropdown">Guild Management - <?php echo $guildDetails->_name; ?> <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="#edit-guild-<?php echo $guildId; ?>" role="tab" data-toggle="tab">Edit Details</a></li>
                            <li><a href="#kill-submission-<?php echo $guildId; ?>" role="tab" data-toggle="tab">Add/Edit Kill Submissions</a></li>
                            <li><a href="#add-raid-team-<?php echo $guildId; ?>" role="tab" data-toggle="tab">Add Raid Team</a></li>
                            <li><a href="#remove-guild-<?php echo $guildId; ?>" role="tab" data-toggle="tab">Remove Guild</a></li>
                        </ul>
                    </li>
                <?php endforeach; ?>

                <li role="presentation"><a href="#new-guild" aria-controls="profile" role="tab" data-toggle="tab"><span class="glyphicon glyphicon-plus"></span>  Create New Guild</a></li>
            </ul>

            <div class="tab-content">
                <br>
                <?php if ( !empty($data->_currentPanel->_dialogOptions) ): ?>
                    <div id="dialog-wrapper" class="row">
                        <div class="col-lg-offset-4 col-lg-4 col-md-12 col-sm-12 col-xs-12">
                            <div class="panel panel-<?php echo $data->_currentPanel->_dialogOptions['type']; ?>">
                                <div class="panel-heading"><?php echo $data->_currentPanel->_dialogOptions['title']; ?></div>
                                <div class="panel-body text-center"><?php echo $data->_currentPanel->_dialogOptions['message']; ?></div>
                            </div>
                        </div>
                    </div>
                <?php endif; ?>

                <div role="tabpanel" class="tab-pane fade <?php if ( $data->_setTab == 'account' ): ?>in active<?php endif; ?>" id="account-management">
                    <?php include 'user-profile.html'; ?>
                </div>

                <?php foreach ( $data->_userGuilds as $guildId => $guildDetails ): ?>
                    <div role="tabpanel" class="tab-pane fade <?php if ( $data->_setTab == 'guild' && $guildId == $data->_tabId ): ?>in active<?php endif; ?>" id="edit-guild-<?php echo $guildId; ?>">
                        <?php include 'guild-profile.html'; ?>
                    </div>

                    <div role="tabpanel" class="tab-pane fade" id="kill-submission-<?php echo $guildId; ?>">
                        <div class="row">
                            <div class="col-lg-offset-4 col-lg-4 col-md-4 col-sm-12 col-xs-12">
                                <div class="panel">
                                    <div class="panel-body">
                                        <form class="form-horizontal" role="form">
                                            <div class="form-group">
                                                <label for="" class="control-label col-lg-3 col-md-2 col-sm-2 col-xs-2">Guild Name</label>
                                                <div class="col-lg-7 col-md-10 col-sm-10 col-xs-10">
                                                    <div class="input-group">
                                                        <input type="text" disabled class="form-control" value="<?php echo $guildDetails->_name; ?>">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label for="" class="control-label col-lg-3 col-md-2 col-sm-2 col-xs-2">Encounter</label>
                                                <div class="col-lg-7 col-md-10 col-sm-10 col-xs-10">
                                                    <select id="user-form-encounter" name="userpanel-encounter" class="form-control">
                                                        <option value="">Select Encounter</option>
                                                        <?php foreach( CommonDataContainer::$encounterArray as $encounterId => $encounterDetails): ?>
                                                            <?php if( !isset($guildDetails->_encounterDetails->$encounterId) ): ?>
                                                                <option value="<?php echo $encounterId; ?>"><?php echo $encounterDetails->_dungeon . '-' . $encounterDetails->_encounterName; ?></option>
                                                            <?php endif; ?>
                                                        <?php endforeach; ?>
                                                    </select>
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label for="" class="control-label col-lg-3 col-md-2 col-sm-2 col-xs-2">Date (M-D-Y)</label>
                                                <div class="form-inline col-lg-7 col-md-10 col-sm-10 col-xs-10">
                                                   <select id="user-form-popup-month" class="form-control" name="quick-month">
                                                        <?php foreach( CommonDataContainer::$monthsArray as $month => $monthValue): ?>
                                                            <?php if ( $month == date('m') ): ?> 
                                                                <option value="<?php echo $month; ?>" selected><?php echo $monthValue; ?></option>
                                                            <?php else: ?>
                                                                <option value="<?php echo $month; ?>"><?php echo $monthValue; ?></option>
                                                            <?php endif; ?>
                                                        <?php endforeach; ?>
                                                    </select>

                                                    <select id="user-form-popup-day" class="form-control" name="quick-day">
                                                        <?php foreach( CommonDataContainer::$daysArray as $day => $dayValue): ?>
                                                            <?php if ( $day == date('d') ): ?> 
                                                                <option value="<?php echo $day; ?>" selected><?php echo $dayValue; ?></option>
                                                            <?php else: ?>
                                                                <option value="<?php echo $day; ?>"><?php echo $dayValue; ?></option>
                                                            <?php endif; ?>
                                                        <?php endforeach; ?>
                                                    </select>

                                                   <select id="user-form-popup-year" class="form-control" name="quick-year">
                                                        <?php foreach( CommonDataContainer::$yearsArray as $year => $yearValue): ?>
                                                            <?php if ( $year == date('Y') ): ?> 
                                                                <option value="<?php echo $year; ?>" selected><?php echo $yearValue; ?></option>
                                                            <?php else: ?>
                                                                <option value="<?php echo $year; ?>"><?php echo $yearValue; ?></option>
                                                            <?php endif; ?>
                                                        <?php endforeach; ?>
                                                    </select>
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label for="" class="control-label col-lg-3 col-md-2 col-sm-2 col-xs-2">Time (H:M UTC)</label>
                                                <div class="form-inline col-lg-7 col-md-10 col-sm-10 col-xs-10">
                                                    <select id="user-form-popup-hour" class="form-control"  name="quick-hour">
                                                        <?php foreach( CommonDataContainer::$hoursArray as $hour => $hourValue): ?>
                                                            <?php if ( $hour == date('H') ): ?> 
                                                                <option value="<?php echo $hour; ?>" selected><?php echo $hourValue; ?></option>
                                                            <?php else: ?>
                                                                <option value="<?php echo $hour; ?>"><?php echo $hourValue; ?></option>
                                                            <?php endif; ?>
                                                        <?php endforeach; ?>
                                                    </select>

                                                   <select id="user-form-popup-minute" class="form-control"  name="quick-minute">
                                                        <?php foreach( CommonDataContainer::$minutesArray as $minute => $minuteValue): ?>
                                                            <?php if ( $minute == date('i') ): ?> 
                                                                <option value="<?php echo $minute; ?>" selected><?php echo $minuteValue; ?></option>
                                                            <?php else: ?>
                                                                <option value="<?php echo $minute; ?>"><?php echo $minuteValue; ?></option>
                                                            <?php endif; ?>
                                                        <?php endforeach; ?>
                                                    </select>
                                                </div>
                                            </div>

                                            <div class="form-group">
                                                <label for="quick-screenshot" class="control-label col-lg-3 col-md-2 col-sm-2 col-xs-2">Screenshot</label>
                                                <div class="col-lg-7 col-md-10 col-sm-10 col-xs-10">
                                                    <input type="file" class="form-control" id="quick-screenshot">
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label for="quick-videos" class="control-label col-lg-3 col-md-2 col-sm-2 col-xs-2">Kill Videos</label>
                                                <div class="col-lg-7 col-md-10 col-sm-10 col-xs-10">
                                                    <div class="video-link-container"></div>
                                                    <a class="btn btn-default new-video-link" href="#"><span class="glyphicon glyphicon-plus"></span>  Add New Video</a>
                                                </div>
                                            </div>
                                            <div class="form-group text-center">
                                                <button type="submit" class="btn btn-default"><span class="glyphicon glyphicon-check"></span>  Submit</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-offset-2 col-lg-8 col-md-4 col-sm-12 col-xs-12">
                                <div class="panel panel-primary">
                                    <table class="table table-striped table-hover">
                                        <tbody>
                                            <?php foreach( CommonDataContainer::$dungeonArray as $dungeonId => $dungeonDetails ): ?>
                                                <?php echo Template::drawSubTitleTableRow(UserPanelModelKill::TABLE_HEADER_PROGRESSION, $dungeonDetails->_name); ?>

                                                <?php if ( !empty($guildDetails->_dungeonDetails->$dungeonId->_complete) ): ?>
                                                    <?php echo Template::drawSubHeaderTableRow(UserPanelModelKill::TABLE_HEADER_PROGRESSION); ?>

                                                    <?php foreach( $guildDetails->_encounterDetails as $encounterId => $encounterDetails ): ?>
                                                        <?php if( isset($dungeonDetails->_encounters->$encounterId) ): ?>
                                                            <?php echo Template::drawBodyTableRow(UserPanelModelKill::TABLE_HEADER_PROGRESSION, $encounterDetails); ?>
                                                        <?php endif; ?>
                                                    <?php endforeach; ?>
                                                <?php else: ?>
                                                    <?php echo Template::drawEmptyGuildTableRow(UserPanelModelKill::TABLE_HEADER_PROGRESSION, 'No guild data found.'); ?>
                                                <?php endif; ?>
                                            <?php endforeach; ?>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div role="tabpanel" class="tab-pane fade" id="add-raid-team-<?php echo $guildId; ?>">
                        <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12 text-center">
                            <div id="faction-logo-preview-wrapper">
                                <?php foreach( CommonDataContainer::$factionArray as $factionId => $factionDetails ): ?>
                                    <div class="thumbnail">
                                        <div id="faction-logo-<?php echo $factionId; ?>" class="faction-logo <?php echo strtolower($factionDetails->_name); ?> <?php if( $factionDetails->_name != $guildDetails->_faction): ?>faded <?php endif; ?>">
                                            <?php echo Functions::getImageFaction($factionDetails->_name); ?>
                                        </div>
                                    </div>
                                <?php endforeach; ?>
                            </div>
                        </div>

                        <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                            <div class="panel">
                                <div class="panel-body">
                                    <form class="form-horizontal" role="form">
                                        <div class="form-group">
                                            <label for="" class="control-label col-lg-3 col-md-2 col-sm-2 col-xs-2">Guild</label>
                                            <div class="col-lg-7 col-md-10 col-sm-10 col-xs-10">
                                                <div class="input-group">
                                                    <input type="text" disabled class="form-control" value="<?php echo $guildDetails->_name; ?>">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="" class="control-label col-lg-3 col-md-2 col-sm-2 col-xs-2">Team Name</label>
                                            <div class="col-lg-7 col-md-10 col-sm-10 col-xs-10">
                                                <div class="input-group">
                                                    <input type="text" class="form-control" placeholder="Enter Team Name">
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="" class="control-label col-lg-3 col-md-2 col-sm-2 col-xs-2">Faction</label>
                                            <div class="col-lg-7 col-md-10 col-sm-10 col-xs-10">
                                                <select id="user-form-faction" name="userpanel-faction" class="form-control">
                                                    <option value="">Select Faction</option>
                                                    <?php foreach( CommonDataContainer::$factionArray as $factionId => $factionDetails): ?>
                                                        <option value="<?php echo $factionId; ?>"><?php echo $factionDetails->_name; ?></option>
                                                    <?php endforeach; ?>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="" class="control-label col-lg-3 col-md-2 col-sm-2 col-xs-2">Server</label>
                                            <div class="col-lg-7 col-md-10 col-sm-10 col-xs-10">
                                                <select id="user-form-server" name="userpanel-server" class="form-control">
                                                    <option value="">Select Server</option>
                                                    <?php foreach( CommonDataContainer::$serverArray as $serverId => $serverDetails): ?>
                                                        <option value="<?php echo $serverId; ?>"><?php echo $serverDetails->_region . '-' . $serverDetails->_name; ?></option>
                                                    <?php endforeach; ?>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="" class="control-label col-lg-3 col-md-2 col-sm-2 col-xs-2">Country</label>
                                            <div class="col-lg-7 col-md-10 col-sm-10 col-xs-10">
                                                <select id="user-form-country" name="userpanel-country" class="form-control">
                                                    <option value="">Select Country</option>
                                                    <?php foreach( CommonDataContainer::$countryArray as $countryId => $countryDetails): ?>
                                                        <option value="<?php echo $countryId; ?>"><?php echo $countryDetails->_name; ?></option>
                                                    <?php endforeach; ?>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="" class="control-label col-lg-3 col-md-2 col-sm-2 col-xs-2">Team Leader(s)</label>
                                            <div class="col-lg-7 col-md-10 col-sm-10 col-xs-10">
                                                <input id="user-form-guild-leader" type="text" name="userpanel-guild-leader" class="form-control" placeholder="Enter Team Leader Name">
                                            </div>
                                        </div>
                                        <div class="form-group text-center">
                                            <button type="submit" class="btn btn-default"><span class="glyphicon glyphicon-check"></span>  Create Raid Team</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12 text-center">
                            <div id="guild-country-logo-preview-wrapper">
                                <div class="thumbnail">
                                    <div id="country-flag-preview"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div role="tabpanel" class="tab-pane fade" id="remove-guild-<?php echo $guildId; ?>">
                        <div class="col-lg-offset-4 col-lg-4 col-md-offset-4 col-md-4 col-sm-12 col-xs-12">
                            <div class="panel panel-primary">
                                <div class="panel-heading">Confirm Removal of Guild</div>
                                <div class="panel-body text-center">
                                    Are you sure you wish to remove <?php echo $guildDetails->_name; ?>?
                                    <p>(Note: This will remove all uploaded data, screenshots, and rank information)</p>
                                    <a href="#" class="btn btn-default"><span class="glyphicon glyphicon-floppy-remove"></span>  Remove Guild</a>
                                </div>
                            </div>
                        </div>
                    </div>
                <?php endforeach; ?>

                <div role="tabpanel" class="tab-pane" id="new-guild">
                    <div class="col-lg-4 col-md-12 col-sm-12 col-xs-12 text-center">
                        <div id="faction-logo-preview-wrapper">
                            <?php foreach( CommonDataContainer::$factionArray as $factionId => $factionDetails ): ?>
                                <div class="thumbnail">
                                    <div id="faction-logo-<?php echo $factionId; ?>" class="faction-logo <?php echo strtolower($factionDetails->_name); ?> faded">
                                        <?php echo Functions::getImageFaction($factionDetails->_name); ?>
                                    </div>
                                </div>
                            <?php endforeach; ?>
                        </div>

                        <div id="guild-country-logo-preview-wrapper">
                            <div class="thumbnail">
                                <div id="guild-logo-preview"></div>
                            </div>

                            <div class="thumbnail">
                                <div id="country-flag-preview"></div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4 col-md-4 col-sm-12 col-xs-12">
                        <div class="panel">
                            <div class="panel-body">
                                <form class="form-horizontal" role="form">
                                    <div class="form-group">
                                        <label for="" class="control-label col-lg-3 col-md-2 col-sm-2 col-xs-2">Guild Name</label>
                                        <div class="col-lg-7 col-md-10 col-sm-10 col-xs-10">
                                            <input type="text" class="form-control" id="register-guild" placeholder="Enter guild name">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="" class="control-label col-lg-3 col-md-2 col-sm-2 col-xs-2">Faction</label>
                                        <div class="col-lg-7 col-md-10 col-sm-10 col-xs-10">
                                            <select id="user-form-faction" class="form-control" name="register-faction">
                                                <option value="">Select Faction</option>
                                                <?php foreach( CommonDataContainer::$factionArray as $factionId => $factionDetails): ?>
                                                    <option value="<?php echo $factionId; ?>" <?php if (!empty($data->_formFields->faction) && $data->_formFields->faction == $factionId): ?>selected<?php endif; ?>><?php echo $factionDetails->_name; ?></option>
                                                <?php endforeach; ?>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="" class="control-label col-lg-3 col-md-2 col-sm-2 col-xs-2">Server</label>
                                        <div class="col-lg-7 col-md-10 col-sm-10 col-xs-10">
                                            <select id="user-form-server" class="form-control" name="register-server">
                                                <option value="">Select Server</option>
                                                <?php foreach( CommonDataContainer::$serverArray as $serverId => $serverDetails): ?>
                                                    <option value="<?php echo $serverId; ?>" <?php if (!empty($data->_formFields->server) && $data->_formFields->server == $serverId): ?>selected<?php endif; ?>><?php echo $serverDetails->_region . ' - ' . $serverDetails->_name; ?></option>
                                                <?php endforeach; ?>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="" class="control-label col-lg-3 col-md-2 col-sm-2 col-xs-2">Country</label>
                                        <div class="col-lg-7 col-md-10 col-sm-10 col-xs-10">
                                            <select id="user-form-country" class="form-control" name="register-country">
                                                <option value="">Select Country</option>
                                                <?php foreach( CommonDataContainer::$countryArray as $countryId => $countryDetails): ?>
                                                    <option value="<?php echo $countryId; ?>" <?php if (!empty($data->_formFields->country) && $data->_formFields->country == $countryId): ?>selected<?php endif; ?>><?php echo $countryDetails->_name; ?></option>
                                                <?php endforeach; ?>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="" class="control-label col-lg-3 col-md-2 col-sm-2 col-xs-2">Guild Leader(s)</label>
                                        <div class="col-lg-7 col-md-10 col-sm-10 col-xs-10">
                                            <input type="text" class="form-control" id="register-guild-leader" placeholder="Enter guild leader name">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="" class="control-label col-lg-3 col-md-2 col-sm-2 col-xs-2">Website</label>
                                        <div class="col-lg-7 col-md-10 col-sm-10 col-xs-10">
                                            <input type="text" class="form-control" id="register-website" placeholder="Enter guild website">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="" class="control-label col-lg-3 col-md-2 col-sm-2 col-xs-2">Facebook</label>
                                        <div class="col-lg-7 col-md-10 col-sm-10 col-xs-10"> 
                                            <input type="text" class="form-control" id="register-facebook" placeholder="Enter Facebook handle">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="" class="control-label col-lg-3 col-md-2 col-sm-2 col-xs-2">Twitter</label>
                                        <div class="col-lg-7 col-md-10 col-sm-10 col-xs-10"> 
                                            <input type="text" class="form-control" id="register-twitter" placeholder="Enter Twitter handle">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="" class="control-label col-lg-3 col-md-2 col-sm-2 col-xs-2">Guild Logo</label>
                                        <div class="col-lg-7 col-md-10 col-sm-10 col-xs-10"> 
                                            <input type="file" class="form-control" id="register-logo">
                                        </div>
                                    </div>
                                    <div class="form-group"> 
                                        <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center">
                                            <button type="submit" class="btn btn-default"><span class="glyphicon glyphicon-plus"></span>  Create Guild</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>